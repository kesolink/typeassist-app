<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TypeAssist</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* ─── Reset & Base ─────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-primary: #0f1219;
      --bg-card: rgba(22, 27, 39, 0.85);
      --bg-input: rgba(15, 18, 25, 0.6);
      --accent: #38bd94;
      --accent-dim: rgba(56, 189, 148, 0.1);
      --accent-border: rgba(56, 189, 148, 0.12);
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --text-dim: #475569;
      --danger: #ef4444;
      --border: rgba(56, 189, 148, 0.08);
      --font-mono: 'JetBrains Mono', monospace;
      --font-body: 'Outfit', sans-serif;
      --radius: 10px;
    }

    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow: hidden;
      user-select: none;
    }

    /* ─── Background ───────────────────────────────────────────── */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse at 20% 0%, rgba(56, 189, 148, 0.05) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(56, 120, 189, 0.03) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* ─── Custom Titlebar ──────────────────────────────────────── */
    .titlebar {
      -webkit-app-region: drag;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 40px;
      padding: 0 12px 0 16px;
      background: rgba(10, 13, 20, 0.9);
      border-bottom: 1px solid var(--border);
      position: relative;
      z-index: 10;
    }

    .titlebar-title {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .titlebar-controls {
      -webkit-app-region: no-drag;
      display: flex;
      gap: 6px;
    }

    .titlebar-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .titlebar-btn:hover { background: rgba(255,255,255,0.06); color: var(--text-secondary); }
    .titlebar-btn.close:hover { background: rgba(239, 68, 68, 0.15); color: var(--danger); }

    /* ─── Login Modal ──────────────────────────────────────────── */
    .login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 18, 25, 0.98);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(10px);
    }

    .login-modal {
      background: #161b27;
      border: 1px solid rgba(56, 189, 148, 0.2);
      border-radius: 16px;
      padding: 32px;
      width: 420px;
      max-width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .login-header h2 {
      font-size: 24px;
      color: #38bd94;
      margin-bottom: 8px;
      text-align: center;
      font-family: var(--font-mono);
    }

    .login-header p {
      font-size: 14px;
      color: #94a3b8;
      text-align: center;
      margin-bottom: 24px;
    }

    .login-form label {
      display: block;
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .login-form input {
      width: 100%;
      padding: 12px;
      background: #0f1219;
      border: 1px solid rgba(56, 189, 148, 0.3);
      border-radius: 8px;
      color: #f1f5f9;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      margin-bottom: 16px;
      transition: all 0.2s;
    }

    .login-form input:focus {
      outline: none;
      border-color: #38bd94;
      box-shadow: 0 0 0 3px rgba(56, 189, 148, 0.1);
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #38bd94, #2d9d7a);
      color: #0f1219;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary:hover {
      transform: scale(1.02);
    }

    .btn-primary:active {
      transform: scale(0.98);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .login-error {
      margin-top: 12px;
      padding: 10px;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      color: #ef4444;
      font-size: 12px;
      text-align: center;
    }

    .login-footer {
      margin-top: 20px;
      text-align: center;
      font-size: 12px;
      color: #64748b;
    }

    .login-footer a {
      color: #38bd94;
      text-decoration: none;
      font-weight: 500;
    }

    .login-footer a:hover {
      text-decoration: underline;
    }

    /* ─── Layout ───────────────────────────────────────────────── */
    .app-container {
      position: relative;
      z-index: 1;
      height: calc(100vh - 40px);
      overflow-y: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 28px;
      border-bottom: 1px solid var(--border);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      background: var(--accent-dim);
      border: 1px solid var(--accent-border);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app-name {
      font-size: 20px;
      font-weight: 700;
      color: #f1f5f9;
      letter-spacing: -0.02em;
      font-family: var(--font-mono);
    }

    .app-tagline {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-dim);
      transition: all 0.3s;
    }

    .status-dot.active {
      background: var(--accent);
      box-shadow: 0 0 8px rgba(56, 189, 148, 0.5);
      animation: pulse 1.5s infinite;
    }

    .status-text {
      font-size: 13px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      font-weight: 500;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .credit-display {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(56, 189, 148, 0.1);
      border: 1px solid rgba(56, 189, 148, 0.3);
      border-radius: 8px;
      color: #38bd94;
      font-weight: 600;
      font-size: 13px;
      font-family: var(--font-mono);
    }

    .credit-display svg {
      opacity: 0.8;
    }

    .logout-btn {
      padding: 8px 12px;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      color: #ef4444;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      transform: scale(1.05);
    }

    .logout-btn:active {
      transform: scale(0.95);
    }

    /* ─── Main Grid ────────────────────────────────────────────── */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 18px;
      padding: 18px 28px 28px;
    }

    .left-col, .right-col {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    /* ─── Cards ────────────────────────────────────────────────── */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      backdrop-filter: blur(10px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .card-label {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: var(--accent);
      font-family: var(--font-mono);
      display: block;
      margin-bottom: 12px;
    }

    .card-header .card-label { margin-bottom: 0; }

    /* ─── Text Stats ───────────────────────────────────────────── */
    .stats-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
      font-family: var(--font-mono);
    }

    .stats-divider { color: #334155; }

    /* ─── Textarea ─────────────────────────────────────────────── */
    .text-input {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--accent-border);
      border-radius: 8px;
      padding: 14px 16px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: var(--font-mono);
      line-height: 1.7;
      resize: vertical;
      min-height: 200px;
      transition: border-color 0.2s;
      outline: none;
    }

    .text-input:focus { border-color: rgba(56, 189, 148, 0.3); }
    .text-input::placeholder { color: var(--text-dim); }
    .text-input:disabled { opacity: 0.5; cursor: not-allowed; }

    .clear-btn {
      margin-top: 10px;
      background: none;
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--danger);
      font-size: 12px;
      font-family: var(--font-mono);
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .clear-btn:hover { background: rgba(239, 68, 68, 0.08); }

    /* ─── Progress ─────────────────────────────────────────────── */
    .progress-card {
      background: var(--bg-card);
      border: 1px solid rgba(56, 189, 148, 0.15);
      border-radius: var(--radius);
      padding: 18px;
      animation: slideUp 0.3s ease;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .progress-percent {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      font-family: var(--font-mono);
    }

    .progress-track {
      width: 100%;
      height: 6px;
      background: #1a1f2e;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #38bd94, #4ade80);
      border-radius: 3px;
      transition: width 0.1s ease;
      animation: progressGlow 2s infinite;
    }

    .progress-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 10px;
      font-family: var(--font-mono);
    }

    .progress-hint kbd {
      display: inline-block;
      background: #1a1f2e;
      border: 1px solid #2d3548;
      border-radius: 4px;
      padding: 1px 6px;
      font-size: 11px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
    }

    /* ─── Countdown Overlay ────────────────────────────────────── */
    .countdown-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      animation: fadeIn 0.2s ease;
    }

    .countdown-number {
      font-size: 80px;
      font-weight: 700;
      color: var(--accent);
      font-family: var(--font-mono);
      text-shadow: 0 0 40px rgba(56, 189, 148, 0.4);
      animation: countPulse 0.8s ease;
    }

    .countdown-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    /* ─── Controls ─────────────────────────────────────────────── */
    .control-group { margin-bottom: 18px; }

    .control-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: block;
    }

    .hotkey-btn {
      width: 100%;
      padding: 10px 16px;
      background: var(--bg-input);
      border: 1px solid var(--accent-border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: var(--font-mono);
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .hotkey-btn:hover { border-color: rgba(56, 189, 148, 0.25); }

    .hotkey-btn.editing {
      background: var(--accent-dim);
      border-color: rgba(56, 189, 148, 0.4);
      color: var(--accent);
    }

    .hotkey-display { font-weight: 600; font-size: 16px; }

    .speed-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .speed-btn {
      padding: 10px 12px;
      background: rgba(15, 18, 25, 0.4);
      border: 1px solid rgba(56, 189, 148, 0.06);
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .speed-btn:hover { border-color: rgba(56, 189, 148, 0.15); }

    .speed-btn.active {
      background: rgba(56, 189, 148, 0.12);
      border-color: rgba(56, 189, 148, 0.3);
    }

    .speed-name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
    .speed-desc { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }


    /* ─── Action Buttons ───────────────────────────────────────── */
    .start-btn {
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(135deg, #38bd94, #2d9d7a);
      border: none;
      border-radius: var(--radius);
      color: var(--bg-primary);
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-body);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
      letter-spacing: 0.02em;
    }

    .start-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
    .start-btn:active { transform: translateY(0); }
    .start-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: none; transform: none; }

    .stop-btn {
      width: 100%;
      padding: 14px 20px;
      background: rgba(239, 68, 68, 0.12);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: var(--radius);
      color: var(--danger);
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-body);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .stop-btn:hover { background: rgba(239, 68, 68, 0.18); }

    /* ─── Steps ────────────────────────────────────────────────── */
    .steps { display: flex; flex-direction: column; gap: 12px; }

    .step {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .step-num {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: var(--accent-dim);
      border: 1px solid var(--accent-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
      font-family: var(--font-mono);
      flex-shrink: 0;
    }

    .step-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      padding-top: 2px;
    }

    .step-text strong { color: var(--accent); font-weight: 600; }

    /* ─── History ───────────────────────────────────────────────── */
    .history-list { display: flex; flex-direction: column; gap: 6px; }

    .history-item {
      padding: 8px 12px;
      background: rgba(15, 18, 25, 0.4);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .history-item:hover { background: rgba(15, 18, 25, 0.7); }

    .history-text {
      font-size: 12px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      display: block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .history-meta {
      font-size: 11px;
      color: var(--text-dim);
      font-family: var(--font-mono);
      margin-top: 2px;
      display: block;
    }

    .clear-hist-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 11px;
      font-family: var(--font-mono);
      cursor: pointer;
    }

    .clear-hist-btn:hover { color: var(--text-secondary); }

    /* ─── Info Card ─────────────────────────────────────────────── */
    .info-card {
      display: flex;
      gap: 12px;
      padding: 14px;
      background: rgba(56, 189, 148, 0.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }

    .info-text {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    /* ─── Notification Toast ───────────────────────────────────── */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--accent-border);
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 13px;
      font-family: var(--font-mono);
      color: var(--text-primary);
      z-index: 200;
      animation: slideUp 0.3s ease, fadeOut 0.3s ease 2.5s forwards;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .toast.error { border-color: rgba(239, 68, 68, 0.3); color: var(--danger); }

    /* ─── Scrollbar ────────────────────────────────────────────── */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: #2d3548; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

    /* ─── Animations ───────────────────────────────────────────── */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translate(-50%, 12px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    @keyframes progressGlow {
      0% { box-shadow: 0 0 8px rgba(56, 189, 148, 0.4); }
      50% { box-shadow: 0 0 16px rgba(56, 189, 148, 0.6); }
      100% { box-shadow: 0 0 8px rgba(56, 189, 148, 0.4); }
    }
    @keyframes countPulse {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

  <!-- Custom Titlebar -->
  <div class="titlebar">
    <span class="titlebar-title">TYPEASSIST</span>
    <div class="titlebar-controls">
      <button class="titlebar-btn" onclick="window.typeassist.minimize()" title="Minimize to tray">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><rect y="5" width="12" height="2" rx="1"/></svg>
      </button>
      <button class="titlebar-btn close" onclick="window.typeassist.close()" title="Minimize to tray">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M1.5 1.5l9 9M10.5 1.5l-9 9" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>

  <!-- Login Modal Overlay -->
  <div id="login-overlay" class="login-overlay" style="display: none;">
    <div class="login-modal">
      <div class="login-header">
        <h2>⌨️ TypeAssist</h2>
        <p>Enter your credit token to continue</p>
      </div>

      <div class="login-form">
        <label for="token-input">Credit Token</label>
        <input type="text" id="token-input" placeholder="TA-XXXXX-XXXXX-XXXXX-XXXXX" maxlength="29" />

        <button id="login-btn" class="btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3"/>
          </svg>
          Activate
        </button>

        <div id="login-error" class="login-error" style="display: none;"></div>
      </div>

      <div class="login-footer">
        <p>Don't have a token? <a href="#" id="purchase-link">Purchase Credits</a></p>
      </div>
    </div>
  </div>

  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <svg width="26" height="26" viewBox="0 0 28 28" fill="none">
            <rect x="2" y="6" width="24" height="16" rx="3" stroke="#38bd94" stroke-width="2" fill="none"/>
            <rect x="6" y="10" width="4" height="3" rx="0.5" fill="#38bd94" opacity="0.6"/>
            <rect x="12" y="10" width="4" height="3" rx="0.5" fill="#38bd94" opacity="0.6"/>
            <rect x="18" y="10" width="4" height="3" rx="0.5" fill="#38bd94" opacity="0.6"/>
            <rect x="8" y="15" width="12" height="3" rx="0.5" fill="#38bd94" opacity="0.4"/>
          </svg>
        </div>
        <div>
          <h1 class="app-name">TypeAssist</h1>
          <p class="app-tagline">OS-Level Virtual Typing</p>
        </div>
      </div>
      <div class="header-right">
        <div class="credit-display" id="credit-display">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
          </svg>
          <span id="credit-count">0</span> credits
        </div>
        <div class="status">
          <div class="status-dot" id="statusDot"></div>
          <span class="status-text" id="statusText">Ready</span>
        </div>
        <button class="logout-btn" id="logout-btn" title="Logout">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-grid">
      <!-- Left Column -->
      <div class="left-col">

        <!-- Text Input -->
        <div class="card">
          <div class="card-header">
            <span class="card-label">PRELOAD TEXT</span>
            <div class="stats-row">
              <span id="charCount">0 chars</span>
              <span class="stats-divider">·</span>
              <span id="wordCount">0 words</span>
            </div>
          </div>
          <textarea
            class="text-input"
            id="textInput"
            placeholder="Paste or type the text you want to auto-type into any application..."
            rows="10"
          ></textarea>
          <button class="clear-btn" id="clearBtn" style="display:none" onclick="clearText()">Clear</button>
        </div>

        <!-- Progress (hidden by default) -->
        <div class="progress-card" id="progressCard" style="display:none">
          <div class="progress-header">
            <span class="card-label" style="margin:0">TYPING PROGRESS</span>
            <span class="progress-percent" id="progressPercent">0%</span>
          </div>
          <div class="progress-track">
            <div class="progress-fill" id="progressFill" style="width:0%"></div>
          </div>
          <p class="progress-hint">Press <kbd>ESC</kbd> to cancel · Typing into focused application</p>
        </div>

        <!-- Instructions -->
        <div class="card">
          <span class="card-label">HOW TO USE</span>
          <div class="steps">
            <div class="step">
              <div class="step-num">1</div>
              <span class="step-text">Paste your text into the preload area above</span>
            </div>
            <div class="step">
              <div class="step-num">2</div>
              <span class="step-text">Choose your typing speed and configure the hotkey</span>
            </div>
            <div class="step">
              <div class="step-num">3</div>
              <span class="step-text"><strong>Click on the target input field</strong> in any application (browser, form, chat, etc.)</span>
            </div>
            <div class="step">
              <div class="step-num">4</div>
              <span class="step-text">Press <strong id="stepHotkey">F9</strong> — TypeAssist will type your text character-by-character</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="right-col">

        <!-- Controls -->
        <div class="card">
          <span class="card-label">CONTROLS</span>

          <div class="control-group">
            <label class="control-label">Activation Hotkey (Global)</label>
            <button class="hotkey-btn" id="hotkeyBtn" onclick="startEditHotkey()">
              <span class="hotkey-display" id="hotkeyDisplay">F9</span>
            </button>
          </div>

          <div class="control-group">
            <label class="control-label">Typing Speed</label>
            <div class="speed-grid">
              <button class="speed-btn" data-speed="slow" onclick="setSpeed('slow')">
                <span class="speed-name">Slow</span>
                <span class="speed-desc">~20 WPM</span>
              </button>
              <button class="speed-btn active" data-speed="normal" onclick="setSpeed('normal')">
                <span class="speed-name">Normal</span>
                <span class="speed-desc">~100 WPM</span>
              </button>
              <button class="speed-btn" data-speed="fast" onclick="setSpeed('fast')">
                <span class="speed-name">Fast</span>
                <span class="speed-desc">~240 WPM</span>
              </button>
              <button class="speed-btn" data-speed="instant" onclick="setSpeed('instant')">
                <span class="speed-name">Instant</span>
                <span class="speed-desc">~600 WPM</span>
              </button>
            </div>
          </div>

          <div id="actionArea">
            <button class="start-btn" id="startBtn" onclick="startTyping()" disabled>
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4 2l10 6-10 6V2z"/></svg>
              Start Typing
            </button>
          </div>
        </div>

        <!-- Delay Option -->
        <div class="card">
          <span class="card-label">START DELAY</span>
          <p style="font-size:12px; color:var(--text-muted); margin-bottom:10px;">
            Seconds to wait before typing starts (gives you time to focus the target field)
          </p>
          <div class="speed-grid">
            <button class="speed-btn" data-delay="0" onclick="setDelay(0)">
              <span class="speed-name">None</span>
              <span class="speed-desc">0s</span>
            </button>
            <button class="speed-btn active" data-delay="3" onclick="setDelay(3)">
              <span class="speed-name">Short</span>
              <span class="speed-desc">3s</span>
            </button>
            <button class="speed-btn" data-delay="5" onclick="setDelay(5)">
              <span class="speed-name">Medium</span>
              <span class="speed-desc">5s</span>
            </button>
            <button class="speed-btn" data-delay="10" onclick="setDelay(10)">
              <span class="speed-name">Long</span>
              <span class="speed-desc">10s</span>
            </button>
          </div>
        </div>

        <!-- History -->
        <div class="card" id="historyCard" style="display:none">
          <div class="card-header">
            <span class="card-label">RECENT</span>
            <button class="clear-hist-btn" onclick="clearHistory()">Clear</button>
          </div>
          <div class="history-list" id="historyList"></div>
        </div>

        <!-- Info -->
        <div class="info-card">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="flex-shrink:0; margin-top:2px">
            <circle cx="8" cy="8" r="7" stroke="#38bd94" stroke-width="1.5"/>
            <path d="M8 7v4M8 5v0.5" stroke="#38bd94" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <p class="info-text">
            TypeAssist sends real OS-level keystrokes via robotjs. It works with <strong style="color:var(--text-secondary)">any application</strong> — 
            browsers, forms, chat apps, terminals, even paste-restricted fields.
            The app stays in your system tray when closed.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- Countdown Overlay -->
  <div class="countdown-overlay" id="countdownOverlay" style="display:none">
    <div class="countdown-number" id="countdownNumber">3</div>
    <p class="countdown-label">Switch to target app now...</p>
  </div>

  <script>
    // ─── State ──────────────────────────────────────────────────
    let currentSpeed = 'normal';
    let currentDelay = 3;
    let currentHotkey = 'F9';
    let isTyping = false;
    let editingHotkey = false;
    let history = [];

    // ─── Authentication State ───────────────────────────────────
    let isAuthenticated = false;
    let currentCredits = 0;
    let userEmail = '';

    // ─── DOM Refs ───────────────────────────────────────────────
    const textInput = document.getElementById('textInput');
    const clearBtn = document.getElementById('clearBtn');
    let startBtn = document.getElementById('startBtn');  // let (not const) so it can be reassigned after button swap
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const progressCard = document.getElementById('progressCard');
    const progressFill = document.getElementById('progressFill');
    const progressPercent = document.getElementById('progressPercent');
    const hotkeyBtn = document.getElementById('hotkeyBtn');
    const hotkeyDisplay = document.getElementById('hotkeyDisplay');
    const stepHotkey = document.getElementById('stepHotkey');
    const historyCard = document.getElementById('historyCard');
    const historyList = document.getElementById('historyList');
    const actionArea = document.getElementById('actionArea');
    const countdownOverlay = document.getElementById('countdownOverlay');
    const countdownNumber = document.getElementById('countdownNumber');

    // ─── Authentication Functions ───────────────────────────────
    async function checkAuthState() {
      const authState = await window.typeassist.getAuthState();

      if (authState.authenticated && authState.credits > 0) {
        isAuthenticated = true;
        currentCredits = authState.credits;
        userEmail = authState.email;

        hideLoginModal();
        updateCreditDisplay();
      } else {
        showLoginModal();
      }
    }

    function showLoginModal() {
      document.getElementById('login-overlay').style.display = 'flex';
      setTimeout(() => document.getElementById('token-input').focus(), 100);
    }

    function hideLoginModal() {
      document.getElementById('login-overlay').style.display = 'none';
    }

    function updateCreditDisplay() {
      document.getElementById('credit-count').textContent = currentCredits;
    }

    // ─── Login Handler ──────────────────────────────────────────
    document.getElementById('login-btn').addEventListener('click', async () => {
      const tokenInput = document.getElementById('token-input');
      const token = tokenInput.value.trim();
      const loginBtn = document.getElementById('login-btn');
      const errorDiv = document.getElementById('login-error');

      if (!token) {
        errorDiv.textContent = 'Please enter a valid token';
        errorDiv.style.display = 'block';
        return;
      }

      // Show loading state
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Verifying...';
      errorDiv.style.display = 'none';

      try {
        const result = await window.typeassist.verifyToken(token);

        if (result.success) {
          isAuthenticated = true;
          currentCredits = result.credits;
          userEmail = result.email;

          hideLoginModal();
          updateCreditDisplay();
          showToast('✓ Login successful!');
          updateStartButtonState();
        } else {
          errorDiv.textContent = result.error || 'Invalid token. Please try again.';
          errorDiv.style.display = 'block';
        }
      } catch (error) {
        errorDiv.textContent = 'Network error. Please try again.';
        errorDiv.style.display = 'block';
      } finally {
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3"/></svg> Activate';
      }
    });

    // ─── Handle Enter Key in Token Input ────────────────────────
    document.getElementById('token-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('login-btn').click();
      }
    });

    // ─── Handle Purchase Link Click ─────────────────────────────
    document.getElementById('purchase-link').addEventListener('click', (e) => {
      e.preventDefault();
      const { shell } = require('electron');
      shell.openExternal('https://typeassist.com/payment');
    });

    // ─── Logout Handler ─────────────────────────────────────────
    document.getElementById('logout-btn').addEventListener('click', async () => {
      if (confirm('Are you sure you want to logout?')) {
        await window.typeassist.logout();

        isAuthenticated = false;
        currentCredits = 0;
        userEmail = '';

        showLoginModal();
        showToast('✓ Logged out successfully');
        updateStartButtonState();
      }
    });

    // ─── Initialize Authentication on Page Load ─────────────────
    checkAuthState();


    // ─── Update Start Button State ──────────────────────────────
    function updateStartButtonState() {
      const text = textInput.value;
      const chars = text.length;
      startBtn.disabled = chars === 0 || !isAuthenticated || currentCredits <= 0;

      // Update button tooltip to show why it's disabled
      if (!isAuthenticated) {
        startBtn.title = 'Please login to start typing';
      } else if (currentCredits <= 0) {
        startBtn.title = 'No credits remaining. Please purchase more credits.';
      } else if (chars === 0) {
        startBtn.title = 'Enter text to start typing';
      } else {
        startBtn.title = 'Start typing (F9)';
      }
    }

    // ─── Text Input Handling ────────────────────────────────────
    textInput.addEventListener('input', () => {
      const text = textInput.value;
      const chars = text.length;
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      document.getElementById('charCount').textContent = `${chars} chars`;
      document.getElementById('wordCount').textContent = `${words} words`;
      clearBtn.style.display = chars > 0 ? 'inline-block' : 'none';

      updateStartButtonState();
    });

    function clearText() {
      textInput.value = '';
      textInput.dispatchEvent(new Event('input'));
    }

    // ─── Speed Selection ────────────────────────────────────────
    function setSpeed(speed) {
      currentSpeed = speed;
      document.querySelectorAll('.speed-btn[data-speed]').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.speed === speed);
      });
    }


    // ─── Delay Selection ────────────────────────────────────────
    function setDelay(delay) {
      currentDelay = delay;
      document.querySelectorAll('.speed-btn[data-delay]').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.delay == delay);
      });
    }

    // ─── Hotkey Editing ─────────────────────────────────────────
    function startEditHotkey() {
      editingHotkey = true;
      hotkeyBtn.classList.add('editing');
      hotkeyDisplay.textContent = 'Press any key...';
      hotkeyDisplay.style.animation = 'pulse 1s infinite';
    }

    document.addEventListener('keydown', (e) => {
      if (!editingHotkey) return;
      e.preventDefault();

      const key = e.key;
      editingHotkey = false;
      hotkeyBtn.classList.remove('editing');
      hotkeyDisplay.textContent = key;
      hotkeyDisplay.style.animation = 'none';
      currentHotkey = key;
      stepHotkey.textContent = key;

      // Tell main process
      if (window.typeassist) {
        window.typeassist.setHotkey(key);
      }
    });

    // ─── Countdown & Start Typing ───────────────────────────────
    async function startTyping() {
      const text = textInput.value;
      if (!text.trim() || isTyping) return;

      // Check authentication
      if (!isAuthenticated) {
        showToast('⚠️ Please login to use TypeAssist', true);
        showLoginModal();
        return;
      }

      // Check credits
      if (currentCredits <= 0) {
        showToast('⚠️ No credits remaining. Please purchase more credits.', true);
        setTimeout(() => {
          const { shell } = require('electron');
          shell.openExternal('https://typeassist.com/payment');
        }, 2000);
        return;
      }

      // Deduct credit BEFORE typing
      try {
        const authState = await window.typeassist.getAuthState();
        const usageResult = await window.typeassist.useCredit(authState.token, authState.deviceId);

        if (!usageResult.success) {
          showToast(`⚠️ ${usageResult.error}`, true);
          if (usageResult.error.includes('No credits') || usageResult.error.includes('credit')) {
            currentCredits = 0;
            updateCreditDisplay();
          }
          return;
        }

        // Update credits after successful deduction
        currentCredits = usageResult.remainingCredits;
        updateCreditDisplay();
        updateStartButtonState();
      } catch (error) {
        showToast(`⚠️ Error: ${error.message}`, true);
        return;
      }

      // Show countdown if delay > 0
      if (currentDelay > 0) {
        countdownOverlay.style.display = 'flex';
        for (let i = currentDelay; i > 0; i--) {
          countdownNumber.textContent = i;
          countdownNumber.style.animation = 'none';
          void countdownNumber.offsetWidth; // reflow
          countdownNumber.style.animation = 'countPulse 0.8s ease';
          await sleep(1000);
        }
        countdownOverlay.style.display = 'none';
      }

      isTyping = true;
      updateStatus(true);
      showProgress(true);
      swapToStopBtn();

      if (window.typeassist) {
        // Real Electron mode — send to main process
        await window.typeassist.startTyping(text, currentSpeed);
      } else {
        // Fallback demo mode (no Electron)
        showToast('Demo mode — robotjs not available outside Electron', true);
        await demoType(text);
      }
    }

    async function stopTyping() {
      if (window.typeassist) {
        await window.typeassist.stopTyping();
      }
      isTyping = false;
      updateStatus(false);
      showProgress(false);
      swapToStartBtn();
    }

    // Demo fallback typing (just updates progress bar)
    async function demoType(text) {
      const delays = { slow: 120, normal: 60, fast: 25, instant: 5 };
      const baseDelay = delays[currentSpeed] || 60;

      for (let i = 0; i < text.length; i++) {
        if (!isTyping) break;
        const pct = ((i + 1) / text.length) * 100;
        updateProgress(pct);
        await sleep(baseDelay + Math.random() * baseDelay * 0.4);
      }

      if (isTyping) {
        addHistory(text);
        showToast('Typing complete!');
      }
      isTyping = false;
      updateStatus(false);
      showProgress(false);
      swapToStartBtn();
    }

    // ─── UI Helpers ─────────────────────────────────────────────
    function updateStatus(active) {
      statusDot.classList.toggle('active', active);
      statusText.textContent = active ? 'Typing...' : 'Ready';
    }

    function showProgress(show) {
      progressCard.style.display = show ? 'block' : 'none';
      if (!show) {
        progressFill.style.width = '0%';
        progressPercent.textContent = '0%';
      }
    }

    function updateProgress(pct) {
      progressFill.style.width = pct + '%';
      progressPercent.textContent = Math.round(pct) + '%';
    }

    function swapToStopBtn() {
      // Replace Start button with Stop button during typing
      actionArea.innerHTML = `
        <button class="stop-btn" onclick="stopTyping()">
          <svg width="12" height="12" viewBox="0 0 14 14" fill="currentColor"><rect width="14" height="14" rx="2"/></svg>
          Stop
        </button>`;
      // Note: Stop button doesn't need state management, always enabled during typing
    }

    function swapToStartBtn() {
      // Recreate the Start button HTML
      actionArea.innerHTML = `
        <button class="start-btn" id="startBtn" onclick="startTyping()">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4 2l10 6-10 6V2z"/></svg>
          Start Typing
        </button>`;

      // Update the startBtn reference to the new DOM element
      startBtn = document.getElementById('startBtn');

      // Update the button state based on all conditions (text, auth, credits)
      updateStartButtonState();
    }

    function showToast(msg, isError = false) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast' + (isError ? ' error' : '');
      toast.textContent = msg;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function addHistory(text) {
      const preview = text.slice(0, 60) + (text.length > 60 ? '...' : '');
      history.unshift({ text: preview, chars: text.length, time: new Date() });
      history = history.slice(0, 10);
      renderHistory();
    }

    function renderHistory() {
      if (history.length === 0) { historyCard.style.display = 'none'; return; }
      historyCard.style.display = 'block';
      historyList.innerHTML = history.map((h, i) => `
        <div class="history-item" onclick="loadHistory(${i})">
          <span class="history-text">${escapeHtml(h.text)}</span>
          <span class="history-meta">${h.chars} chars · ${h.time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
        </div>
      `).join('');
    }

    function loadHistory(i) {
      if (history[i]) {
        textInput.value = history[i].text;
        textInput.dispatchEvent(new Event('input'));
      }
    }

    function clearHistory() { history = []; renderHistory(); }
    function escapeHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    // ─── Listen for IPC Events from Electron Main Process ───────
    if (window.typeassist) {
      window.typeassist.onHotkeyTriggered(() => startTyping());

      window.typeassist.onTypingProgress((data) => {
        updateProgress(data.progress);
      });

      window.typeassist.onTypingComplete(() => {
        addHistory(textInput.value);
        showToast('Typing complete!');
        isTyping = false;
        updateStatus(false);
        showProgress(false);
        swapToStartBtn();
      });

      window.typeassist.onTypingCancelled(() => {
        showToast('Typing cancelled');
        isTyping = false;
        updateStatus(false);
        showProgress(false);
        swapToStartBtn();
      });

      window.typeassist.onTypingStopped((charIndex) => {
        showToast(`Stopped after ${charIndex} characters`);
        isTyping = false;
        updateStatus(false);
        showProgress(false);
        swapToStartBtn();
      });

      window.typeassist.onTypingError((msg) => {
        showToast(msg, true);
        isTyping = false;
        updateStatus(false);
        showProgress(false);
        swapToStartBtn();
      });

      window.typeassist.onHotkeyError((key) => {
        showToast(`Failed to register hotkey: ${key}`, true);
      });
    }
  </script>
</body>
</html>
